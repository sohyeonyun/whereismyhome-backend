<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.home.model.mapper.HouseLikeMapper">
	
	<!-- 아파트 찜하기 -->
	<select id="listHouseLike" parameterType="String" resultType="UserHouseLikeDTO">
		SELECT DISTINCT i.apartmentname,
		                Concat(c.sidoname, ' ', c.gugunname, ' ', c.dongname) location,
		                i.buildyear,
		                d.dealamount,
		                Concat(d.dealyear, '.', d.dealmonth, '.', d.dealday)  date,
		                d.area,
		                d.floor,
		                i.lat,
		                i.lng,
		                (SELECT Count(*)
		                 FROM   house_like
		                 WHERE  aptcode = i.aptcode)
		                house_like_count
		FROM   houseinfo AS i
		       LEFT JOIN dongcode AS c
		              ON i.dongcode = c.dongcode
		       LEFT JOIN housedeal AS d
		              ON i.aptcode = d.aptcode
		       LEFT JOIN house_like AS hl
		              ON i.aptcode = hl.aptcode
		WHERE  hl.user_id = #{userId}
	</select>
	
	<insert id="registHouseLike" parameterType="AreaLikeDTO">
		insert into house_like
		(user_id, aptCode, ip_address)
    	values (#{userId}, #{aptCode}, #{ipAddress})
	</insert>
	
	<delete id="deleteHouseLike" parameterType="Map">
		delete from house_like
		where user_id = #{userId} and aptCode = #{aptCode}
	</delete>
</mapper>